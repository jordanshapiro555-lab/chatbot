<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Simple Chatbot</title>
    <style>
      body { font-family: system-ui; max-width: 720px; margin: 40px auto; padding: 0 16px; }
      #log { border: 1px solid #ddd; border-radius: 12px; padding: 12px; min-height: 240px; }
      .msg { margin: 10px 0; }
      .me { font-weight: 600; }
      .bot { color: #111; }
      form { display: flex; gap: 8px; margin-top: 12px; }
      input { flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; }
      button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; background: #fff; }
    </style>
  </head>
  <body>
    <h1>My Chatbot</h1>
    <div id="log"></div>

    <form id="chat">
      <input id="text" placeholder="Ask something..." autocomplete="off" />
      <button type="submit">Send</button>
    </form>

    <script>
      const WORKER_URL = "https://YOUR-WORKER-URL.workers.dev"; // <-- change this
      const log = document.getElementById("log");
      const form = document.getElementById("chat");
      const input = document.getElementById("text");

      const messages = [
        { role: "system", content: "You are a helpful, concise assistant." }
      ];

      function addLine(label, text, cls) {
        const div = document.createElement("div");
        div.className = "msg " + cls;
        div.innerHTML = `<span class="${cls === "me" ? "me" : "bot"}">${label}:</span> ${text}`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;

        addLine("You", text, "me");
        messages.push({ role: "user", content: text });
        input.value = "";

        const res = await fetch(WORKER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages }),
        });

        const data = await res.json();

        // Cloudflare AI responses commonly return { response: "..." } or similar.
        const reply = data.response || data.result || JSON.stringify(data);
        addLine("Bot", reply, "bot");
        messages.push({ role: "assistant", content: reply });
      });
    </script>
  </body>
</html>
